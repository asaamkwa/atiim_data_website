<%- include('partials/header') %>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-5">

      <div class="card shadow">
        <div class="card-body">

          <h4 class="text-center mb-4">Create Account</h4>

          <% if (typeof error !== 'undefined') { %>
            <div class="alert alert-danger"><%= error %></div>
          <% } %>

          <form id="registerForm" method="POST" action="/auth/register" novalidate>

            <div class="mb-3">
              <label>Full Name</label>
              <input type="text" class="form-control" name="name" required>
            </div>

            <div class="mb-3">
              <label>Phone Number</label>
              <input type="tel" class="form-control" name="phone" id="phoneInput" required>
              <div id="phoneError" class="invalid-feedback d-none">
                Please enter a valid Ghana phone number.
              </div>
            </div>

            <div class="mb-3">
              <label>Email Address</label>
              <input type="email" class="form-control" name="email" required>
            </div>

            <div class="mb-3">
              <label>Password</label>
              <input type="password" class="form-control" name="password" required>
            </div>

            <button class="btn btn-success w-100">Register</button>
          </form>

          <p class="text-center mt-3">
            Already have an account?
            <a href="/auth/login">Login</a>
          </p>

        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const phoneInput = document.getElementById('phoneInput');
  const phoneError = document.getElementById('phoneError');

  // Validate Ghana phone number
  function isValidGhanaNumber(number) {
    const ghRegex = /^(?:\+233|0)?(24|25|54|55|50|20|27|26|28|57|59)\d{7}$/;
    return ghRegex.test(number);
  }

  phoneInput.addEventListener('input', function () {
    const value = this.value.trim();
    if (value === "") {
      phoneError.classList.add("d-none");
      this.classList.remove("is-invalid");
      this.classList.remove("is-valid");
      return;
    }

    if (!isValidGhanaNumber(value)) {
      phoneError.classList.remove("d-none");
      this.classList.add("is-invalid");
      this.classList.remove("is-valid");
    } else {
      phoneError.classList.add("d-none");
      this.classList.remove("is-invalid");
      this.classList.add("is-valid");
    }
  });

  // Optional: normalize number to 233 format before submission
  const form = document.getElementById('registerForm');
  form.addEventListener('submit', function (e) {
    const val = phoneInput.value.trim();
    if (!isValidGhanaNumber(val)) {
      e.preventDefault();
      phoneError.classList.remove("d-none");
      phoneInput.classList.add("is-invalid");
      return;
    }

    if (val.startsWith("0")) {
      phoneInput.value = "233" + val.slice(1);
    } else if (val.startsWith("+233")) {
      phoneInput.value = "233" + val.slice(4);
    }
  });
</script>

<%- include('partials/footer') %>
